# Скрипт обработки лог-файлов

Python-скрипт для обработки JSON лог-файлов и генерации различных отчетов. Этот проект реализует систему обработки лог-файлов, которая может анализировать логи веб-сервера и генерировать статистические отчеты.

## Возможности

- **Поддержка нескольких файлов**: Обработка одного или нескольких лог-файлов одновременно
- **Фильтрация по дате**: Фильтрация логов по конкретным датам с помощью параметра `--date`
- **Расширяемая архитектура**: Легко добавлять новые типы отчетов
- **Обработка ошибок**: Надежная обработка ошибок для неверного JSON и отсутствующих файлов
- **Комплексное тестирование**: Полное покрытие тестами с использованием pytest

## Требования

- Python 3.12
- tabulate
- pytest

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/KnightCode1024/processing-log-file-test-task.git
cd processing-log-file-test-task
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Использование

Обработка одного лог-файла и генерация отчета о среднем времени ответа:

```bash
python main.py --file example.log --report average
```

### Несколько файлов

Обработка нескольких лог-файлов:

```bash
python main.py --file log1.log log2.log log3.log --report average
```

### Фильтрация по дате

Фильтрация логов по конкретной дате:

```bash
python main.py --file example.log --report average --date 2025-06-22
```

### Пример вывода

```
+----------------------+-------+-------------------+
| handler              | total | avg_response_time |
+======================+=======+===================+
| /api/challenges/...  |   1   |      0.056       |
+----------------------+-------+-------------------+
| /api/context/...     |  15   |      0.032       |
+----------------------+-------+-------------------+
| /api/homeworks/...   |  45   |      0.142       |
+----------------------+-------+-------------------+
| /api/specializations/|   6   |      0.035       |
+----------------------+-------+-------------------+
| /api/users/...       |   1   |      0.072       |
+----------------------+-------+-------------------+
```

## Формат лог-файла

Скрипт ожидает JSON записи логов со следующей структурой:

```json
{
  "@timestamp": "2025-06-22T13:57:32+00:00",
  "status": 200,
  "url": "/api/endpoint",
  "request_method": "GET",
  "response_time": 0.024,
  "http_user_agent": "Mozilla/5.0..."
}
```

## Доступные отчеты

### Отчет о среднем времени (`--report average`)

Генерирует отчет, показывающий:
- **handler**: URL API-эндпоинта
- **total**: Количество запросов к этому эндпоинту
- **avg_response_time**: Среднее время ответа для этого эндпоинта

## Тестирование

Запуск тестов:

```bash
pytest test_main.py -v
```

Запуск тестов с покрытием:

```bash
pytest test_main.py --cov=main --cov-report=term-missing
```

## Обработка ошибок

Скрипт обрабатывает различные условия ошибок:

- **Неверный JSON**: Пропускает неправильно сформированные строки с предупреждениями
- **Отсутствующие файлы**: Предупреждает и продолжает работу с доступными файлами
- **Неверные даты**: Проверяет формат даты перед обработкой
- **Пустые результаты**: Показывает соответствующее сообщение, когда данные не соответствуют критериям

## Аргументы командной строки

- `--file`: Лог-файл(ы) для обработки (обязательный, поддерживает несколько файлов)
- `--report`: Тип отчета для генерации (обязательный, в настоящее время поддерживает 'average')
- `--date`: Фильтрация логов по дате в формате ГГГГ-ММ-ДД (необязательный)

## Примеры

### Обработка включенного примера файла:

```bash
python main.py --file example.log --report average
```

### Обработка нескольких файлов с фильтрацией по дате:

```bash
python main.py --file log1.log log2.log --report average --date 2025-06-22
```

### Получение справки:

```bash
python main.py --help
```
